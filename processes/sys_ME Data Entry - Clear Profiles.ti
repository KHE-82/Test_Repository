#region Prolog

#****Begin: Generated Statements***
#****End: Generated Statements****

#*********************************************************************************************************************
#**** PROCESS:               sys_ME Data Entry - Clear Profiles
#**** DESCRIPTION:       This process creates a view from the AE Adj cube and post data to ME4_reporting cube
#****
#****                                  It takes parameters from the source worksheet:
#****
#**** MODIFICATION HISTORY:
#****
#****  Date               Initials        Comments
#****  ====              ======      =========
#**** 28/02/2018    KG             Initial Revision
#***********************************************************************************************************************

#---------------------------------------------------------------------------------------------------------------------------
#*** DECLARE AE CUBES & DIMENSIONS ***#
#---------------------------------------------------------------------------------------------------------------------------
snProg = 'programme';
cbAE = 'AE adjustments';
dmHLYear = 'headline year';
dmScenario = 'scenario';
dmStatus = 'status';
dmOC = 'outcome';
dmRE = 'related entity';
dmFunc = 'function';
dmReason = 'reason';
dmSPP = 'spp';
dmMeasCode = 'measure code';
dmType = 'appropriation type';
dmMA = 'movement account';
dmItem = 'appropriation item';
dmProg = snProg;
dmAcc = 'account';
dmID = 'id';
dmJur = 'jurisdiction';
dmPer = 'period';

#--------------------------------------------------------------------------------------------------------------------------
#*** DIMENSION ATTRIBUTES
#--------------------------------------------------------------------------------------------------------------------------
dmReasonAttr = '}ElementAttributes_reason';
dmAccAttr = '}ElementAttributes_account';


#---------------------------------------------------------------------------------------------------------------------------
#*** DECLARE AE ID DETAILS CUBE ***#
#---------------------------------------------------------------------------------------------------------------------------
cbID = 'AE id details';


#---------------------------------------------------------------------------------------------------------------------------
#*** DECLARE PROGRAMME DETAILS CUBE ***#
#---------------------------------------------------------------------------------------------------------------------------
cbProg = snProg | ' details';
dmProgMeas = snProg | ' measure';

#---------------------------------------------------------------------------------------------------------------------------
#*** DECLARE MONTHLY ESTIMATES CUBE
#---------------------------------------------------------------------------------------------------------------------------
#cbME = 'ME reporting';
#dmMEMeas = 'ME reporting measure';
cbME = 'ME4_adjustments';
dmMEMeas = 'ME4_adjustment_measure';

#---------------------------------------------------------------------------------------------------------------------------
#*** DECLARE SYSTEM DIMENSIONS ***# 
#---------------------------------------------------------------------------------------------------------------------------
dmVar = 'variables';
dmClients = '}Clients';
sImpFilePath = ATTRS(dmVar, 'sys_ImpFileExceptionLogs', ' value');

#---------------------------------------------------------------------------------------------------------------------------
#*** GET CURRENT HEADLINE YEAR AND SCENARIO ****#
#---------------------------------------------------------------------------------------------------------------------------
curHLYear = ATTRS(dmVar,'headline year','value');
curScenario = ATTRS(dmVar, 'headline scenario', 'value');

#---------------------------------------------------------------------------------------------------------------------------
#*** DECLARE SUBSETS AND VIEWS ***#
#---------------------------------------------------------------------------------------------------------------------------
sUser = TM1User();
IF (SUBST(sUser,1,3) @= 'CAM');
	sUser = ATTRS(dmClients, sUser, '}TM1_DefaultDisplayValue');
	lScan = SCAN('\',sUser) + 1;
	sUser = SUBST(sUser, lScan, 9);
ELSE;
	sUser = TM1User();
ENDIF;

sMEView = sUser | ' $MELoadCSV';

sStatus = 'Total approved';
sOC = 'Total outcomes';
sReason = 'Total reason';
sFunc = 'Total functions';
sSPP = 'Total SPP';
sAppType = 'Total approp types';
sItem = 'Total approp item';
sMeasCode = 'Total Measures';
sID = 'Total IDs';

sRptMeas = 'value';

#*** FILE VALIDATION FLAG VARIABLES
nLine = 1;
nTotalValid = 0;



#------------------------------------------------
#---- Program Subset Used in View
#------------------------------------------------
sProgSubset = 'sysME_' | psNatManager;

#----------------------------------------------------------------------------------------------------------------------------------------------------------------
#*** STEP 1 - CLEAR TARGET CUBE 
#----------------------------------------------------------------------------------------------------------------------------------------------------------------

#---------------------------------------------------------------------------------------------------------------------------
#*** DELETE EXISTING VIEWS AND SUBSETS ***#
#---------------------------------------------------------------------------------------------------------------------------
VIEWDESTROY (cbME, sMEView);
SUBSETDESTROY (dmHLYear, sMEView);
SUBSETDESTROY (dmScenario, sMEView);
SUBSETDESTROY (dmID, sMEView);
#SUBSETDESTROY (dmProg, sMEView);

#---------------------------------------------------------------------------------------------------------------------------
#****CREATE SUBSETS****#
#---------------------------------------------------------------------------------------------------------------------------
# headline year
SubsetCreate(dmHLYear, sMEView);
SubsetElementInsert(dmHLYear, sMEView, psHLYear, 1);

# Scenario
SubsetCreate(dmScenario, sMEView);
SubsetElementInsert(dmScenario, sMEView, psScenario, 1);


# ID
SubsetCreate(dmID, sMEView);
SubsetElementInsert(dmID, sMEView, psID, 1);


#*** BUILD VIEW ***#
VIEWCREATE (cbME, sMEView);
VIEWSUBSETASSIGN (cbME, sMEView, dmHLYear, sMEView);
VIEWSUBSETASSIGN (cbME, sMEView, dmScenario, sMEView);
VIEWSUBSETASSIGN (cbME, sMEView, dmProg, sProgSubset);
VIEWSUBSETASSIGN (cbME, sMEView, dmID, sMEView);

VIEWZEROOUT (cbME, sMEView);


#---------------------------------------------------------------------------------------------------------------------------
#*** DELETE EXISTING VIEWS AND SUBSETS ***#
#---------------------------------------------------------------------------------------------------------------------------
VIEWDESTROY (cbME, sMEView);
SUBSETDESTROY (dmHLYear, sMEView);
SUBSETDESTROY (dmScenario, sMEView);
SUBSETDESTROY (dmID, sMEView);

#endregion
#region Metadata

#****Begin: Generated Statements***
#****End: Generated Statements****

#endregion
#region Data

#****Begin: Generated Statements***
#****End: Generated Statements****

#endregion
#region Epilog

#****Begin: Generated Statements***
#****End: Generated Statements****
#endregion